# 6.4 网络流算法

### 定义

* 一个**流量网络**是一张边的权重（这里称为**容量**）为正的加权有向图。
* 一个 **st- 流量网络**有两个已知的顶点，即起点 s 和终点 t。
* st- 流量网络中的 **st- 流量配置**是由一组和每条边相关联的值组成的集合，这个值被称为**边的流量**。如果所有边的流量均小于边的容量且满足每个顶点的**局部平衡**（即净流量 = 流入量 - 流出量 = 0，s 和 t 除外），那么就称这种流量配置方案是**可行的**。
* **最大流量问题**：给定一个 st- 流量网络，找到一种 st- 流量配置，使得从 s 到 t 的流量最大化。

### API

FlowEdge 并不基于之前的 DirectedEdge，因为需要使每条边都出现在它的两个顶点的邻接表中才能实现剩余网络。**剩余网络**能够增减流量并检测一条边是否已经饱和（无法再增大流量）或者是否为空（无法再减小流量）。

流量网络中的边的 API：

| public class FlowEdge | 说明 | 
| :----: | :----: |
| FlowEdge(int v, int w, double cap) | |
| int from() | 这条边的起始顶点 |
| int to()  | 这条边的目的顶点 |
| int other(int v) | 边的另一个顶点 |
| double capacity() | 边的容量 |
| double flow() | 边中的流量 |
| double residualCapacityTo(int v) | v 的剩余流量 |
| double addResidualFlowTo(int v, double delta) | 将 v 的流量增加 delta |
| String toString() | 对象的字符串表示 |

流量网络的 API：

| public class FlowNetwork | 说明 | 
| :----: | :----: |
| FlowNetwork(int V) | 创建一个含有 V 个顶点的空网格 |
| FlowNetwork(In in) | 从输入流中构造流量网络 |
| int V() | 顶点总数 |
| int E() | 边的总数 |
| void addEdge(FlowEdge e) | 向流量网络中添加边 e |
| Iterable<FlowEdge> adj(int v) | 从 v 指出的边 |
| Iterable<FlowEdge> edges() | 流量网络中的所有边 |
| String toString() | 对象的字符串表示 |

### Ford-Fulkerson 算法

一种计算网络中流量分配的方法：

1. 找到任一条从起点到终点的有向路径，增大流量为该路径上所有边中未使用容量的最小值；
2. 找到另一条路径，如此反复，直到所有从起点到终点的路径上至少有一条边是饱和的。

上述方法只在某些情况下能够计算出网络中的最大流量。因此我们将依据变为网络所对应的无向图中从起点到终点的路径。

一些概念如下：

* 正向边：沿着路径从起点向终点前进时，经过方向与流量方向相同的边；
* 逆向边：经过方向与流量方向相反的边；
* **增广路径**：满足所有正向边非饱和、所有逆向边非空的路径。

**Ford-Fulkerson 最大流量算法**：网络中的初始流量为 0，沿着任意从起点到终点（且不含有饱和的正向边或是空逆向边）的增光路径增大流量，直到网络中不存在这样的路径为止。

### 证明：最大流-最小切分定理

**st- 切分**：一个将顶点 s 和顶点 t 分配于不同集合中的切分。

**最大流-最小切分定理**：令 f 为一个 st- 流量网络，以下三种条件是等价的：

* 存在某个 st- 切分，其容量和 f 的流量相等；
* f 到达了最大流量；
* f 中已经不存在任何增广路径。